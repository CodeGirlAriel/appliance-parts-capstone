<h2>Supplier Comparison</h2>

<div *ngIf="comparison">
  <h3>Part: {{ comparison.partId }} - {{ comparison.partName }}</h3>

  <div style="margin: 10px 0;">
    <label>Sort by: </label>
    <select (change)="onSortChange($event)">
      <option value="">Default</option>
      <option value="CHEAPEST">Lowest Price</option>
      <option value="FASTEST_SHIPPING">Fastest Shipping</option>
    </select>
  </div>

  <table border="1" style="width: 100%; border-collapse: collapse;">
    <thead>
      <tr style="background-color: #f0f0f0;">
        <th style="padding: 8px;">Supplier</th>
        <th style="padding: 8px;">Price</th>
        <th style="padding: 8px;">In Stock</th>
        <th style="padding: 8px;">Shipping Time (days)</th>
        <th style="padding: 8px;">Quantity</th>
        <th style="padding: 8px; width: 200px;">Action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let option of comparison.options">
        <td style="padding: 8px;">{{ option.supplierName }}</td>
        <td style="padding: 8px;">${{ option.partCost | number:'1.2-2' }}</td>
        <td style="padding: 8px;">{{ option.numInStock }}</td>
        <td style="padding: 8px;">{{ option.shippingTime }}</td>
        <td style="padding: 8px;">
          <input 
            type="number" 
            min="1" 
            [max]="option.numInStock"
            [(ngModel)]="quantities[option.partSupplierId]"
            style="width: 60px;"
          />
        </td>
        <td style="padding: 4px 8px; width: 200px;">
          <div style="display: flex; flex-direction: row; gap: 4px; justify-content: center;">
            <button 
              (click)="addToCart(option.partSupplierId)"
              [disabled]="!quantities[option.partSupplierId] || quantities[option.partSupplierId] <= 0 || savingToCart[option.partSupplierId] || savingAsQuote[option.partSupplierId]"
              style="padding: 4px 8px; cursor: pointer; background-color: #4CAF50; color: white; border: none; border-radius: 4px; font-size: 12px; white-space: nowrap;"
              [style.opacity]="(savingToCart[option.partSupplierId] || savingAsQuote[option.partSupplierId]) ? '0.6' : '1'"
            >
              {{ savingToCart[option.partSupplierId] ? 'Adding...' : 'Add to Cart' }}
            </button>
            <button 
              (click)="saveAsQuote(option.partSupplierId)"
              [disabled]="!quantities[option.partSupplierId] || quantities[option.partSupplierId] <= 0 || savingToCart[option.partSupplierId] || savingAsQuote[option.partSupplierId]"
              style="padding: 4px 8px; cursor: pointer; background-color: #2196F3; color: white; border: none; border-radius: 4px; font-size: 12px; white-space: nowrap;"
              [style.opacity]="(savingToCart[option.partSupplierId] || savingAsQuote[option.partSupplierId]) ? '0.6' : '1'"
            >
              {{ savingAsQuote[option.partSupplierId] ? 'Saving...' : 'Save as Quote' }}
            </button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="comparison.options.length === 0" style="padding: 20px; text-align: center;">
    <p>No suppliers available for this part.</p>
  </div>
</div>

<div *ngIf="loading" style="padding: 20px; text-align: center;">
  <p>Loading comparison...</p>
</div>

<div *ngIf="!loading && !comparison && !error" style="padding: 20px; text-align: center;">
  <p>No comparison data available.</p>
</div>

<div *ngIf="error" style="padding: 10px; background-color: #ffebee; color: #c62828; margin: 10px 0;">
  {{ error }}
</div>

<div *ngIf="successMessage" style="padding: 15px; background-color: #e8f5e9; color: #2e7d32; margin: 20px 0; border: 2px solid #4CAF50; border-radius: 4px; font-weight: bold;">
  ✓ {{ successMessage }}
  <br><br>
  <a *ngIf="successAction === 'cart'" routerLink="/cart" style="color: #2e7d32; text-decoration: underline; font-weight: normal; margin-right: 15px;">View Cart →</a>
  <a *ngIf="successAction === 'quote'" routerLink="/quotes" style="color: #2e7d32; text-decoration: underline; font-weight: normal;">View Saved Quotes →</a>
</div>