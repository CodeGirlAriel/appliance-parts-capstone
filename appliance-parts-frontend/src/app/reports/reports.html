<div style="max-width: 1400px; margin: 0 auto; padding: 20px;">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h2>{{ reportTitle }}</h2>
    <button 
      (click)="exportToCSV()"
      [disabled]="orders.length === 0 || loading"
      style="padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;"
    >
      Export to CSV
    </button>
  </div>

  <div style="margin-bottom: 20px; padding: 15px; background-color: #f5f5f5; border-radius: 4px;">
    <p style="margin: 5px 0;"><strong>Report Generated:</strong> {{ generatedDate | date:'full' }}</p>
    <p style="margin: 5px 0;"><strong>Total Orders:</strong> {{ orders.length }}</p>
    <p style="margin: 5px 0;"><strong>Quotes (Cart Items):</strong> {{ getQuotesCount() }}</p>
    <p style="margin: 5px 0;"><strong>Purchased Orders:</strong> {{ getPurchasedOrdersCount() }}</p>
    <p style="margin: 5px 0;"><strong>Canceled Orders:</strong> {{ getCanceledOrdersCount() }}</p>
    <p style="margin: 5px 0;"><strong>Total Subtotal:</strong> ${{ calculateTotalSubtotal() | number:'1.2-2' }}</p>
    <p style="margin: 5px 0;"><strong>Total Tax:</strong> ${{ calculateTotalTax() | number:'1.2-2' }}</p>
    <p style="margin: 5px 0;"><strong>Grand Total:</strong> ${{ calculateTotalAmount() | number:'1.2-2' }}</p>
  </div>

  <div *ngIf="loading" style="padding: 20px; text-align: center;">
    <p>Loading report data...</p>
  </div>

  <div *ngIf="error" style="padding: 15px; background-color: #ffebee; color: #c62828; margin: 20px 0; border: 2px solid #c62828; border-radius: 4px; font-weight: bold;">
    <strong>Error:</strong> {{ error }}
  </div>

  <div *ngIf="orders.length === 0 && !loading" style="padding: 20px; text-align: center;">
    <p>No orders available for report.</p>
    <p><a routerLink="/">Search for parts</a> to add items to cart or create quotes.</p>
  </div>

  <div *ngIf="orders.length > 0 && !loading" style="overflow-x: auto;">
    <table border="1" style="width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px;">
      <thead>
        <tr style="background-color: #2196F3; color: white;">
          <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Order ID</th>
          <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Part ID</th>
          <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Part Name</th>
          <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Supplier</th>
          <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Quantity</th>
          <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Unit Price</th>
          <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Subtotal</th>
          <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Tax Amount</th>
          <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">Total Amount</th>
          <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Date Created</th>
          <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Status</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of orders; let i = index" [style.background-color]="getRowColor(order.status, i)">
          <td style="padding: 10px; border: 1px solid #ddd;">{{ order.orderId }}</td>
          <td style="padding: 10px; border: 1px solid #ddd;">
            <div *ngFor="let item of order.items">
              <strong>{{ item.part.partId }}</strong>
            </div>
          </td>
          <td style="padding: 10px; border: 1px solid #ddd;">
            <div *ngFor="let item of order.items">
              {{ item.part.partName }}
            </div>
          </td>
          <td style="padding: 10px; border: 1px solid #ddd;">
            <div *ngFor="let item of order.items">
              {{ item.supplierName || 'N/A' }}
            </div>
          </td>
          <td style="padding: 10px; border: 1px solid #ddd; text-align: right;">
            <div *ngFor="let item of order.items">
              {{ item.quantity }}
            </div>
          </td>
          <td style="padding: 10px; border: 1px solid #ddd; text-align: right;">
            <div *ngFor="let item of order.items">
              ${{ item.unitPrice | number:'1.2-2' }}
            </div>
          </td>
          <td style="padding: 10px; border: 1px solid #ddd; text-align: right;">
            <div *ngFor="let item of order.items">
              ${{ (item.unitPrice * item.quantity) | number:'1.2-2' }}
            </div>
          </td>
          <td style="padding: 10px; border: 1px solid #ddd; text-align: right;">${{ order.taxAmount | number:'1.2-2' }}</td>
          <td style="padding: 10px; border: 1px solid #ddd; text-align: right; font-weight: bold;">${{ order.totalAmount | number:'1.2-2' }}</td>
          <td style="padding: 10px; border: 1px solid #ddd;">{{ order.createdAt | date:'short' }}</td>
          <td style="padding: 10px; border: 1px solid #ddd;">
            <span [style.color]="getStatusColor(order.status)" [style.font-weight]="'bold'">
              {{ order.status }}
            </span>
          </td>
        </tr>
      </tbody>
      <tfoot>
        <tr style="background-color: #e3f2fd; font-weight: bold;">
          <td colspan="6" style="padding: 12px; border: 1px solid #ddd; text-align: right;">Totals:</td>
          <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${{ calculateTotalSubtotal() | number:'1.2-2' }}</td>
          <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${{ calculateTotalTax() | number:'1.2-2' }}</td>
          <td style="padding: 12px; border: 1px solid #ddd; text-align: right;">${{ calculateTotalAmount() | number:'1.2-2' }}</td>
          <td colspan="2" style="padding: 12px; border: 1px solid #ddd;"></td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

